// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
    id String @unique
    timeBefore DateTime
    experience BigInt
    memberships Member[]
    inventories Inventory[]
    anonymousNickName String?
}

model CoinTransfer {
    id Int  @id @default(autoincrement())
    member Member @relation(fields: [userID, guildID], references: [userID, guildID])
    userID String
    guildID String
    amount BigInt
    time DateTime
    guild Guild @relation(fields: [guildID], references: [id])
    detail String?
    transactionID String
    category TransferCategory @default(issueCoin)
}

model Member {
    userOfSelf User @relation(fields: [userID], references: [id])
    userID String
    guildBelong Guild @relation(fields: [guildID], references: [id])
    guildID String
    experienceInGuild BigInt
    coinBalanceInGuild BigInt
    coinTransfers CoinTransfer[]
    memberBadges MemberBadge[]
    @@unique([userID, guildID])
}

model Guild {
    id String @unique
    announcementChannelID String?
    languageInGuild LanguageEnum @default(English)
    commandsUpdatedAt DateTime @default(now())
    notificationChannelID String?
    administratorRoleID String?
    timeZone String
    coinTransfers CoinTransfer[]
    members Member[]
    inventories Inventory[]
    gifts Gift[]
    badges Badge[]
}

model Inventory {
    id Int @id @default(autoincrement())
    name String
    inventoryValue BigInt @default(0)
    category InventoryCategory @default(gift)
    ownerID String
    owner User @relation(fields: [ownerID], references: [id])
    createdAt DateTime @default(now())
    guildID String
    guild Guild @relation(fields: [guildID], references: [id])
}

model Gift {
    name String
    emoji String
    price BigInt
    giftAnnouncement String
    description String
    guildID String
    guild Guild @relation(fields: [guildID], references: [id])
    @@unique([name, guildID])
}

model Badge {
    id Int  @id @default(autoincrement())
    name String
    emoji String
    desc String
    price BigInt
    roleIDRelated String
    guildID String
    guild Guild @relation(fields: [guildID], references: [id])
    memberBadge MemberBadge[]
}

model MemberBadge {
    badgeID Int
    badge Badge @relation(fields: [badgeID], references: [id])
    userID String
    guildID String
    member Member @relation(fields: [userID, guildID], references: [userID, guildID])
    expiredAt DateTime @default(now())
    autoRenew Boolean @default(false)
    @@unique([badgeID, userID, guildID])
}

enum LanguageEnum {
    ChineseSimplified
    English
}

enum TransferCategory { // Change in TransferCategory need the change in language
    transferIn
    transferOut
    issueCoin
    collectCoin
    earnFromVoice
    earnFromMessage
    earnFromCheckIn
    sendGift
    buyBadge
}

enum InventoryCategory {
    gift
}
